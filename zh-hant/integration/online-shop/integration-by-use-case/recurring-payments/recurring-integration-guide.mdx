---
id: recurring-integration-guide
title: 訂閱支付整合指南
description: 開發者指南，涵蓋整合訂閱支付功能的操作流程、資料模型與最佳實踐。
sidebar_label: 整合指南
-------------------

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import Link from '@docusaurus/Link';

# 訂閱支付整合指南

本指南提供整合 QFPay 訂閱支付（定期付款）功能的步驟說明，包括必要條件、API 呼叫順序，以及實際環境中的最佳實踐。

---

## 前置條件

開始整合前，請確認以下事項：

* 您已擁有 API 認證憑證（`AppCode`、`AppKey`）。
* 您已設定 Notify URL，用於接收 QFPay 傳送的非同步 Webhook 通知。
* 前端已具備整合與渲染 [Payment Element](/docs/online-shop/checkout-integration/payment-element) 的能力。

---

## 整合流程總覽

整個訂閱支付的整合流程包含以下步驟：

1. **設定 Webhook 接收端**，可接收 `payment_token`、`subscription` 與 `subscription_payment` 通知。
2. **建立 Customer 物件** 並取得 `customer_id`。
3. **在前端渲染 Payment Element**，使用 `payment.pay()` 搭配 `customer_id` 來建立付款 token。
4. **透過 Webhook 通知或 API 回應** 捕捉 `token_id`。
5. **建立 Product 物件**，定義每期金額、週期頻率與間隔。
6. **建立 Subscription 訂閱計劃**，傳入 `customer_id`、`token_id` 與 `product_id`。
7. （選用）透過 webhook 或 [查詢 API](/docs/recurring-api-reference#query-subscription) 監控訂閱狀態。

![recurring-payment-flow](https://www.plantuml.com/plantuml/png/fLJDZYCr4BxxAKfp9n8iS9W3MYq8YTkYvRPQeOfTdPXnbpqkUqBpzCJT7NSxz92ivkPqVLN-VifvBmbZohrJg9EFeBCatrC4b7gUI-UJFY8dGAbdfGB6PBKDfT3_AOEKyaF5oY29-eS6zjm574ROxxz-n64JSmeZu5pkYHCSCD49XnPZHJB54VVRTFo0_FIWr27w7E3RtSVeJTP9OKwUSx-dg2gnRtwQw3w2ZeI98CpWyMifZpIlo-3tVv5E4EavaoJ5FX54UpWcbIAoe4xMCs3lCxUVT8wHM0-As41fKvCF2v58AKUkDrbJe1Srt-r-hd7S8wU6jwsdrlz7K8KmzgHwlxUE5FLedJeVdUK3e36HH6vgggDQKUzsbu3_y4_4yDbsPGmCb6QUvijQRXspN60vv3COem7BdT-zfZUD5xHYuMJJ4S94eL6EqHozCxDs63y0dwVJty760KmPUUq2g4RchPXdvHCnM-WNlEsinh8mQv--tttAUz7HXbAvuOXCq3s11D9b7WI7_8en4tmQlBK4pae2twss4f0DF6VaPDFGIBwMDEQ98JYhSU_eIpLC3zgHGC28FIMAjnT85lrbykmBoi3w63txB40l9SNh_f3bs7RFYpNZYPkD_67NsIW9Bam_B_hO9elE_aFGGcRLRrxKvOAjbHopHBVox55Tcs8JnMbtgfsB7wVmU9bRSqQNuDqldyRVDf81ZKBg52ghwdz1wICwHtoW1Hz9WcUvZktkjkh1nR3IQMmaNRRegZtWWHfdhKWkBTfpsSqMhgRgmgaEHZPhVki_QMl-4yiBHTiDA-iak-fWOsyBhPYAtVAr7RjbumQAd11qqOwS7OcqkRrzFXlrbI-iosp0K8c1pDrFiRZ-GjilySVTX_RVOls-dFS1CYVhOBz6GLby7q4ZQtAEJ1lGH70YkvbA8-DkfPNwUsAJU_Sl)

---

## 最佳實踐

:::note
請使用 [查詢 API](/docs/recurring-api-reference#query-subscription)￼同步訂閱狀態到 CRM 系統。
:::

:::tip
每次建立訂閱後，請確認收到 webhook，狀態為 `ACTIVE` 或 `INCOMPLETE`，以確認建立成功。
:::

:::warning
請務必在資料庫中儲存 `subscription_id` 與 `token_id，以便後續追蹤、補扣款、取消或報表用途。`
:::
---

## 下一步

* [API 參考文件](/docs/recurring-api-reference)
* [Webhook 通知說明](/docs/recurring-webhook)
* [Element SDK 整合指南](/docs/online-shop/checkout-integration/payment-element)